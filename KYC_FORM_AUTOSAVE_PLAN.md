# KYC Form Auto-Save Implementation Plan

## üìä –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

### –ß—Ç–æ –µ—Å—Ç—å —Å–µ–π—á–∞—Å:
1. ‚úÖ **Multi-step —Ñ–æ—Ä–º–∞** —Å 4 —à–∞–≥–∞–º–∏ (Personal Info ‚Üí Contact & Address ‚Üí Compliance ‚Üí Intended Use)
2. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è** –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
3. ‚úÖ **–¢–∞–±–ª–∏—Ü–∞ `KycFormData`** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã (key-value pairs)
4. ‚úÖ **API `/api/kyc/submit-form`** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
5. ‚ùå **–ù–ï–¢ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è** - –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `useState`
6. ‚ùå **–ù–ï–¢ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è** - –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è
7. ‚ùå **–ù–ï–¢ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏

### –ü—Ä–æ–±–ª–µ–º—ã:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ—Ä—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–ª—É—á–∞–π–Ω–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –ø–æ–∑–∂–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
- –ù–µ—Ç feedback –æ —Ç–æ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- –ü–ª–æ—Ö–æ–π UX –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ñ–æ—Ä–º (15-20 –º–∏–Ω—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è)

---

## üéØ –¶–µ–ª–∏ —Ä–µ—à–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏
2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. **–ò–Ω–¥–∏–∫–∞—Ü–∏—è** —Å—Ç–∞—Ç—É—Å–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (Saved / Saving / Error)
4. **Debounce** –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–∞ –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª)
5. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞** –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –Ω–µ–º—É
6. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å –æ–±–æ–∏–º–∏ KYC –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ (KYCAID –∏ Sumsub)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã `KycFormData`
3. –ù–µ –Ω–∞—Ä—É—à–∞—Ç—å —Ç–µ–∫—É—â–∏–π flow (consents ‚Üí form ‚Üí submission)
4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ partial save (–Ω–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### 1. Backend API

#### A. –ù–æ–≤—ã–π endpoint: `POST /api/kyc/save-draft`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ —Ñ–æ—Ä–º—ã (partial save)

```typescript
// src/app/api/kyc/save-draft/route.ts

interface SaveDraftRequest {
  formData: Record<string, any>;
  currentStep: number;
  completedSteps: number[];
}

interface SaveDraftResponse {
  success: boolean;
  sessionId: string;
  fieldsSaved: number;
  lastSaved: string; // ISO timestamp
}
```

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–∏—Ç—å/—Å–æ–∑–¥–∞—Ç—å `KycSession` –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **Upsert** –¥–∞–Ω–Ω—ã–µ –≤ `KycFormData` (–Ω–µ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ, —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è—Ç—å/–¥–æ–±–∞–≤–ª—è—Ç—å)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `currentStep` –∏ `completedSteps` –≤ `metadata` KYC session
4. **–ù–ï** –æ–±–Ω–æ–≤–ª—è—Ç—å `submittedAt` (—ç—Ç–æ —á–µ—Ä–Ω–æ–≤–∏–∫, –Ω–µ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞)
5. –í–µ—Ä–Ω—É—Ç—å timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–û—Ç–ª–∏—á–∏—è –æ—Ç `/api/kyc/submit-form`:**
- `save-draft` - partial save, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `submit-form` - final save, —Ç—Ä–µ–±—É–µ—Ç –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
- `save-draft` - –Ω–µ –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å KYC session
- `submit-form` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `submittedAt`

---

#### B. –ù–æ–≤—ã–π endpoint: `GET /api/kyc/load-draft`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∞

```typescript
// src/app/api/kyc/load-draft/route.ts

interface LoadDraftResponse {
  success: boolean;
  formData: Record<string, any>;
  currentStep: number;
  completedSteps: number[];
  lastSaved: string | null;
  hasDraft: boolean;
}
```

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–∏—Ç—å `KycSession` –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ï—Å–ª–∏ –Ω–µ—Ç - –≤–µ—Ä–Ω—É—Ç—å `hasDraft: false`
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ `KycFormData` –¥–ª—è —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
4. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –æ–±—ä–µ–∫—Ç `{ fieldName: fieldValue }`
5. –ò–∑–≤–ª–µ—á—å `currentStep` –∏ `completedSteps` –∏–∑ `metadata`
6. –í–µ—Ä–Ω—É—Ç—å –¥–∞–Ω–Ω—ã–µ

---

### 2. Frontend Changes

#### A. –ù–æ–≤—ã–π —Ö—É–∫: `useKycFormAutosave`

```typescript
// src/hooks/useKycFormAutosave.ts

interface UseKycFormAutosaveOptions {
  formData: Record<string, any>;
  currentStep: number;
  completedSteps: number[];
  enabled: boolean; // –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ consents
}

interface UseKycFormAutosaveReturn {
  saveStatus: 'idle' | 'saving' | 'saved' | 'error';
  lastSaved: Date | null;
  saveNow: () => Promise<void>; // Manual save
  loadDraft: () => Promise<LoadDraftResponse>;
}

export function useKycFormAutosave(options: UseKycFormAutosaveOptions): UseKycFormAutosaveReturn {
  // 1. Debounced auto-save (3 seconds –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
  // 2. Save on step change
  // 3. Save before unload (window.beforeunload)
  // 4. Retry logic –¥–ª—è failed saves
}
```

**–§—É–Ω–∫—Ü–∏–∏:**
1. **Debounced save** - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è `formData`
2. **Save on step change** - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏
3. **Save before unload** - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –æ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
4. **Retry logic** - –ø–æ–≤—Ç–æ—Ä—è—Ç—å failed saves (3 –ø–æ–ø—ã—Ç–∫–∏)
5. **Optimistic updates** - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "Saving..." —Å—Ä–∞–∑—É

---

#### B. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/app/(client)/kyc/page.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–î–æ–±–∞–≤–∏—Ç—å —Ö—É–∫ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```typescript
const {
  saveStatus,
  lastSaved,
  saveNow,
  loadDraft
} = useKycFormAutosave({
  formData,
  currentStep,
  completedSteps: [], // Track completed steps
  enabled: !showConsentsScreen // –í–∫–ª—é—á–∏—Ç—å –ø–æ—Å–ª–µ consents
});
```

2. **–ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –ø—Ä–∏ mount:**
```typescript
useEffect(() => {
  const loadSavedDraft = async () => {
    const draft = await loadDraft();
    if (draft.hasDraft) {
      setFormData(draft.formData);
      setCurrentStep(draft.currentStep);
      toast.info(`Draft loaded from ${formatDateTime(draft.lastSaved)}`);
    }
  };
  
  if (!showConsentsScreen) {
    loadSavedDraft();
  }
}, [showConsentsScreen]);
```

3. **–†—É—á–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏:**
```typescript
const handleNext = async () => {
  // ... existing validation ...
  
  // Save before moving to next step
  await saveNow();
  
  if (currentStep < STEPS.length) {
    setCurrentStep(currentStep + 1);
  }
};
```

4. **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ UI:**
```tsx
{/* Auto-save indicator */}
{!showConsentsScreen && (
  <div className="flex items-center gap-2 text-sm text-muted-foreground">
    {saveStatus === 'saving' && (
      <>
        <Loader2 className="h-3 w-3 animate-spin" />
        <span>Saving...</span>
      </>
    )}
    {saveStatus === 'saved' && lastSaved && (
      <>
        <Check className="h-3 w-3 text-green-600" />
        <span>Saved {formatDistanceToNow(lastSaved, { addSuffix: true })}</span>
      </>
    )}
    {saveStatus === 'error' && (
      <>
        <AlertCircle className="h-3 w-3 text-red-600" />
        <span>Failed to save</span>
        <Button variant="ghost" size="sm" onClick={saveNow}>
          Retry
        </Button>
      </>
    )}
  </div>
)}
```

5. **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
```typescript
useEffect(() => {
  const handleBeforeUnload = (e: BeforeUnloadEvent) => {
    if (saveStatus === 'saving') {
      e.preventDefault();
      e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
    }
  };
  
  window.addEventListener('beforeunload', handleBeforeUnload);
  return () => window.removeEventListener('beforeunload', handleBeforeUnload);
}, [saveStatus]);
```

---

### 3. Database Changes

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `KycSession.metadata`:**

```json
{
  "draft": {
    "currentStep": 2,
    "completedSteps": [1],
    "lastSaved": "2025-11-07T23:00:00.000Z",
    "fieldCount": 15
  },
  "applicant": { ... }, // Existing Sumsub/KYCAID data
  "formFieldsCount": 25, // Existing field
  "lastFormUpdate": "..." // Existing field
}
```

**–ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!** –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è:
- `KycFormData` - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
- `KycSession.metadata` - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞

---

## üìê –û—Ü–µ–Ω–∫–∞ –æ–±—ä–µ–º–∞ —Ä–∞–±–æ—Ç

### Backend (3-4 —á–∞—Å–∞):
1. ‚úÖ **`POST /api/kyc/save-draft`** - 1.5 —á–∞—Å–∞
   - –õ–æ–≥–∏–∫–∞ upsert –¥–ª—è `KycFormData`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `metadata` –≤ `KycSession`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - Error handling

2. ‚úÖ **`GET /api/kyc/load-draft`** - 1 —á–∞—Å
   - –ó–∞–≥—Ä—É–∑–∫–∞ `KycFormData`
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –æ–±—ä–µ–∫—Ç
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `metadata`

3. ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API** - 0.5 —á–∞—Å–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ upsert logic
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ load logic
   - Edge cases (no session, no draft)

---

### Frontend (4-5 —á–∞—Å–æ–≤):
1. ‚úÖ **–•—É–∫ `useKycFormAutosave`** - 2 —á–∞—Å–∞
   - Debounced save logic
   - Save on step change
   - Before unload handler
   - Retry logic
   - State management

2. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `kyc/page.tsx`** - 1.5 —á–∞—Å–∞
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö—É–∫–∞
   - Load draft on mount
   - Save on step change
   - UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

3. ‚úÖ **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** - 0.5 —á–∞—Å–∞
   - Save status indicator
   - Retry button
   - Toast notifications

4. ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - 1 —á–∞—Å
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
   - Edge cases

---

### –ò—Ç–æ–≥–æ: **7-9 —á–∞—Å–æ–≤** (1-1.5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)

---

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ—à–∞–≥–æ–≤—ã–π)

### Phase 1: Backend API (2-3 —á–∞—Å–∞)
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å `src/app/api/kyc/save-draft/route.ts`
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å `src/app/api/kyc/load-draft/route.ts`
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø—ã –≤ `src/types/kyc.ts`
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API —á–µ—Ä–µ–∑ Postman/curl

### Phase 2: Frontend Hook (2 —á–∞—Å–∞)
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å `src/hooks/useKycFormAutosave.ts`
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å debounced save
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å load draft
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å retry logic

### Phase 3: UI Integration (2-3 —á–∞—Å–∞)
1. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ö—É–∫ –≤ `kyc/page.tsx`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å load draft on mount
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å save on step change
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å before unload handler

### Phase 4: Testing & Polish (1 —á–∞—Å)
1. ‚úÖ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ flow
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ edge cases
3. ‚úÖ UX improvements
4. ‚úÖ Documentation

---

## üé® UX Improvements

### 1. Save Status Indicator
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ü–æ–¥ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º —à–∞–≥–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Step 2 of 4: Contact & Address      ‚îÇ
‚îÇ ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 50%           ‚îÇ
‚îÇ ‚úì Saved 2 minutes ago               ‚îÇ ‚Üê Auto-save indicator
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. Draft Recovery Dialog
**–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –µ—Å–ª–∏ –µ—Å—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìù Resume your KYC verification?    ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ You have a saved draft from         ‚îÇ
‚îÇ Nov 7, 2025 at 10:30 PM             ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ [Start Fresh]  [Continue Draft]    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3. Unsaved Changes Warning
**–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ö†Ô∏è Unsaved changes                  ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ Your changes are being saved...     ‚îÇ
‚îÇ Please wait a moment.               ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ [Wait]  [Leave Anyway]             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîí Security Considerations

1. ‚úÖ **Authentication** - –≤—Å–µ API —Ç—Ä–µ–±—É—é—Ç `getClientSession()`
2. ‚úÖ **Authorization** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
3. ‚úÖ **Validation** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ backend
4. ‚úÖ **Rate limiting** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å limit –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ saves –≤ –º–∏–Ω—É—Ç—É
5. ‚úÖ **Data sanitization** - –æ—á–∏—Å—Ç–∫–∞ HTML/JS –∏–∑ —Å—Ç—Ä–æ–∫ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

---

## üìä Metrics & Monitoring

### –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
1. **Save success rate** - –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
2. **Average save time** - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
3. **Draft recovery rate** - —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫ —á–µ—Ä–Ω–æ–≤–∏–∫–∞–º
4. **Completion rate** - —Å–∫–æ–ª—å–∫–æ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –¥–æ—Ö–æ–¥—è—Ç –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```typescript
console.log('üìù Draft saved:', {
  userId,
  sessionId,
  fieldCount,
  currentStep,
  duration: Date.now() - startTime
});
```

---

## ‚úÖ Acceptance Criteria

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- [ ] –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏
- [ ] –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (Saving/Saved/Error)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "Save Draft"
- [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- [ ] –ß–µ—Ä–Ω–æ–≤–∏–∫ –Ω–µ –º–µ—à–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 3 —Å–µ–∫—É–Ω–¥—ã (debounce)
- [ ] API `/save-draft` –æ—Ç–≤–µ—á–∞–µ—Ç < 500ms
- [ ] API `/load-draft` –æ—Ç–≤–µ—á–∞–µ—Ç < 300ms
- [ ] –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI –≤–æ –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### UX:
- [ ] –ü–æ–Ω—è—Ç–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- [ ] Toast notification –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∞
- [ ] –ö–Ω–æ–ø–∫–∞ "Retry" –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- [ ] –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

---

## üêõ Edge Cases

### 1. Concurrent saves
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É —à–∞–≥–∞–º–∏  
**–†–µ—à–µ–Ω–∏–µ:** Debounce + queue –¥–ª—è saves

### 2. Network failure
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –∏–∑-–∑–∞ —Å–µ—Ç–∏  
**–†–µ—à–µ–Ω–∏–µ:** Retry logic (3 –ø–æ–ø—ã—Ç–∫–∏) + –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É

### 3. Session expired
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è  
**–†–µ—à–µ–Ω–∏–µ:** Redirect –Ω–∞ login, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å draft –≤ localStorage –∫–∞–∫ backup

### 4. Multiple tabs
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª —Ñ–æ—Ä–º—É –≤ 2 –≤–∫–ª–∞–¥–∫–∞—Ö  
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–∫–∞–∑–∞—Ç—å warning "Form is open in another tab"

### 5. Partial validation
**–ü—Ä–æ–±–ª–µ–º–∞:** –ß–µ—Ä–Ω–æ–≤–∏–∫ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  
**–†–µ—à–µ–Ω–∏–µ:** –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ, –Ω–µ –ø—Ä–∏ save-draft

---

## üìù Implementation Notes

### Best Practices:
1. **Optimistic updates** - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "Saving..." —Å—Ä–∞–∑—É, –Ω–µ –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞
2. **Silent failures** - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É –∫–∞–∂–¥—ã–π —Ä–∞–∑, —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫
3. **Minimal disruption** - –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å UI –≤–æ –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
4. **Clear feedback** - –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
5. **Graceful degradation** - –µ—Å–ª–∏ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ñ–æ—Ä–º–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Testing Checklist:
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ logout/login
- [ ] –†–∞–±–æ—Ç–∞ —Å –º–µ–¥–ª–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º
- [ ] –†–∞–±–æ—Ç–∞ offline (–ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É)
- [ ] –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫
- [ ] –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å KYCAID –∏ Sumsub

---

## üéØ Success Metrics

### Before:
- ‚ùå 0% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–≥—É—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ
- ‚ùå 100% –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
- ‚ùå –ù–µ—Ç feedback –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

### After:
- ‚úÖ 100% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–≥—É—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–µ—Ä–Ω–æ–≤–∏–∫—É
- ‚úÖ 0% –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Ä—è–µ—Ç—Å—è (–ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏)
- ‚úÖ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π feedback –æ —Å—Ç–∞—Ç—É—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ completion rate –Ω–∞ 20-30%

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!** üöÄ

–•–æ—á–µ—à—å –Ω–∞—á–∞—Ç—å —Å Phase 1 (Backend API)?

