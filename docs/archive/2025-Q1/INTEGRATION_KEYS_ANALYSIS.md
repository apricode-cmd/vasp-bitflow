# üîç –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏–∑ –°–∏—Å—Ç–µ–º—ã –•—Ä–∞–Ω–µ–Ω–∏—è API –ö–ª—é—á–µ–π

## –î–∞—Ç–∞: 2025-01-26

---

## üìä –¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ

### 1. **–ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–´–ï –ò–°–¢–û–ß–ù–ò–ö–ò –ö–õ–Æ–ß–ï–ô** ‚ùå

–°–µ–π—á–∞—Å API –∫–ª—é—á–∏ –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ **3 –º–µ—Å—Ç–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**:

#### A. Environment Variables (`.env`, `.env.local`)
```bash
RESEND_API_KEY="re_xxxxxxxxxxxx"
KYCAID_API_KEY="..."
COINGECKO_API_URL="..."
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- `src/lib/config.ts` - —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `config.email.apiKey = process.env.RESEND_API_KEY`
- `src/lib/services/kycaid.ts` - fallback –µ—Å–ª–∏ –Ω–µ—Ç –≤ –ë–î
- –°—Ç–∞—Ä—ã–π –∫–æ–¥ (legacy)

#### B. Database `Integration` table
```sql
Integration {
  service: string        -- 'resend', 'sumsub', 'tatum'
  apiKey: string?        -- –ó–ê–®–ò–§–†–û–í–ê–ù–ù–´–ô –∫–ª—é—á
  apiEndpoint: string?
  config: Json?          -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  isEnabled: boolean
  status: string
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- `IntegrationFactory` - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç
- `integration-management.service.ts` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏ —à–∏—Ñ—Ä—É–µ—Ç
- –ù–æ–≤–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

#### C. Database `Integration.config` (JSON)
```json
{
  "apiKey": "re_xxxxxxxxxxxx",  // ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º!
  "appToken": "sbx:...",
  "secretKey": "...",
  "fromEmail": "..."
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- Sumsub - —Ö—Ä–∞–Ω–∏—Ç `appToken`, `secretKey`, `levelName`
- Resend - –∏–Ω–æ–≥–¥–∞ –ø–æ–ø–∞–¥–∞–µ—Ç —Å—é–¥–∞ –≤–º–µ—Å—Ç–æ `apiKey` field
- –ú–Ω–æ–≥–æ–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

## üîÑ –ü–æ—Ç–æ–∫ –î–∞–Ω–Ω—ã—Ö

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (UI ‚Üí Database)

```
1. Admin –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç /admin/integrations
2. –í–≤–æ–¥–∏—Ç API key –≤ —Ñ–æ—Ä–º—É
3. UI –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
   PUT /api/admin/integrations
   {
     service: 'resend',
     updates: {
       apiKey: 're_8AChNGre_7Ho83xrY2zF36xMT3214qtvF',  // Plain text
       config: { fromEmail: '...' }
     }
   }

4. integration-management.service.ts:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: –Ω–µ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ –∫–ª—é—á? (contains '‚Ä¢' or '*')
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: –Ω–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω –ª–∏ —É–∂–µ? (starts with 'encrypted:')  // ‚úÖ –ù–û–í–û–ï
   - –®–∏—Ñ—Ä—É–µ—Ç: encrypt(apiKey) ‚Üí 'encrypted:iv:tag:data'
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ Integration.apiKey

5. Database:
   Integration {
     apiKey: 'encrypted:a1b2c3...:d4e5f6...:g7h8i9...'  // ‚úÖ –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ
     config: { fromEmail: '...' }                        // ‚úÖ –ë–µ–∑ apiKey
   }
```

### –ó–∞–≥—Ä—É–∑–∫–∞ (Database ‚Üí Provider)

```
1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω—É–∂–µ–Ω email provider
2. IntegrationFactory.getProviderByService('resend')

3. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ –ë–î:
   const integration = await prisma.integration.findUnique({ 
     where: { service: 'resend' } 
   });

4. –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç apiKey:
   try {
     decryptedApiKey = decrypt(integration.apiKey);
     // ‚úÖ 're_8AChNGre_7Ho83xrY2zF36xMT3214qtvF'
   } catch (error) {
     // ‚ùå –ï—Å–ª–∏ –¥–≤–æ–π–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ - –æ—à–∏–±–∫–∞
     console.error('Failed to decrypt API key');
     decryptedApiKey = undefined;
   }

5. –ú–µ—Ä–¥–∂–∏—Ç config:
   const config = {
     apiKey: decryptedApiKey || undefined,
     apiEndpoint: integration.apiEndpoint,
     ...integration.config  // –ú–µ—Ä–¥–∂–∏—Ç –≤—Å–µ –∏–∑ config
   };

6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç provider:
   await provider.initialize(config);
   // ResendAdapter –ø–æ–ª—É—á–∞–µ—Ç config.apiKey
   this.client = new Resend(config.apiKey);
```

---

## üêõ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: **–î–≤–æ–π–Ω–æ–µ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** ‚ùå

**–ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ö–ª—é—á —É–∂–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω –≤ –ë–î: `'encrypted:...'`
2. UI –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π: `'re_‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢qtvF'`
3. Admin "–ø–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç" –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
4. UI –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **–≤–µ—Å—å –æ–±—ä–µ–∫—Ç** `integrations[service]`
5. –ï—Å–ª–∏ –≤ –æ–±—ä–µ–∫—Ç–µ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–π `apiKey` (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π), –æ–Ω —à–∏—Ñ—Ä—É–µ—Ç—Å—è —Å–Ω–æ–≤–∞!
6. –†–µ–∑—É–ª—å—Ç–∞—Ç: `encrypt('encrypted:...')` ‚Üí `'encrypted:encrypted:...'`

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ `integration-management.service.ts`:
```typescript
const isAlreadyEncrypted = updates.apiKey.startsWith('encrypted:') || 
                           updates.apiKey.startsWith('plain:');
if (isAlreadyEncrypted) {
  console.warn('‚ö†Ô∏è Attempting to encrypt already encrypted key - skipping');
  // Keep existing key
}
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: **–ö–ª—é—á–∏ –≤ Config –≤–º–µ—Å—Ç–æ apiKey** ‚ùå

**–ü—Ä–∏–º–µ—Ä - Resend:**
```json
// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
Integration {
  apiKey: 'encrypted:...',  // –î–≤–æ–π–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ null
  config: {
    apiKey: 're_xxxxxxxxxxxx'  // –ó–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á –ø–æ–ø–∞–ª —Å—é–¥–∞!
  }
}

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
Integration {
  apiKey: 'encrypted:...',  // –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π
  config: {
    fromEmail: 'onboarding@resend.dev'  // –¢–æ–ª—å–∫–æ –¥–æ–ø. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  }
}
```

**–ü—Ä–∏—á–∏–Ω–∞:** UI –¥–ª—è Resend –Ω–µ –∏–º–µ–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ (–∫–∞–∫ —É Sumsub)

### –ü—Ä–æ–±–ª–µ–º–∞ 3: **Sumsub —Ç—Ä–µ–±—É–µ—Ç 3 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞** ‚ö†Ô∏è

Sumsub - –æ—Å–æ–±—ã–π —Å–ª—É—á–∞–π:
- `appToken` - —Ç–æ–∫–µ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `secretKey` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è HMAC
- `levelName` - —É—Ä–æ–≤–µ–Ω—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**
```typescript
// UI —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –≤ config:
{
  apiKey: appToken,  // –î—É–±–ª–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  config: {
    appToken: '...',
    secretKey: '...',
    levelName: '...'
  }
}

// Adapter —á–∏—Ç–∞–µ—Ç –∏–∑ config:
this.config = {
  appToken: configAny.appToken || config.apiKey,  // Fallback
  secretKey: configAny.secretKey,
  levelName: configAny.levelName
};
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ç—É—Å –æ—Å—Ç–∞–µ—Ç—Å—è `inactive` –µ—Å–ª–∏ `apiKey` field –ø—É—Å—Ç–æ–π

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:
```typescript
const hasApiKey = integration.apiKey || updates.apiKey;
const hasConfigData = updates.config && Object.keys(updates.config).length > 0;

if (hasApiKey || hasConfigData) {
  updateData.status = 'active';
}
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: **Fallback –Ω–∞ ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** ‚ö†Ô∏è

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–µ—Ä–≤–∏—Å—ã (KYCAID, —Å—Ç–∞—Ä—ã–π email) –∏–º–µ—é—Ç fallback:
```typescript
if (integration?.apiKey) {
  // Use from database
} else {
  // Fallback to env variables
  config.email.apiKey  // from process.env.RESEND_API_KEY
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –æ—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è –∫–ª—é—á, —Å–ª–æ–∂–Ω–æ –¥–µ–±–∞–∂–∏—Ç—å

---

## üìã –ú–∞—Ç—Ä–∏—Ü–∞ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | apiKey Field | config JSON | ENV Fallback | –°—Ç–∞—Ç—É—Å |
|------------|--------------|-------------|--------------|--------|
| **Resend** | ‚ùå –î–≤–æ–π–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå –ó–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á | ‚úÖ –î–∞ | ‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ ENV |
| **Sumsub** | ‚ùå –ü—É—Å—Ç–æ–π | ‚úÖ appToken, secretKey, levelName | ‚ùå –ù–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ config |
| **Tatum** | ‚ùå –î–≤–æ–π–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ | ‚ùì –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ | ‚ùå –ù–µ—Ç | ‚ùå –û—à–∏–±–∫–∞ |
| **CoinGecko** | ‚ùå –î–≤–æ–π–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ | ‚ùì –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ | ‚úÖ –î–∞ | ‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ ENV |
| **KYCAID** | ‚ùå –ü—É—Å—Ç–æ–π | ‚úÖ –ï—Å—Ç—å config | ‚úÖ –î–∞ | ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –†–µ—à–µ–Ω–∏–µ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è: **–ï–¥–∏–Ω—ã–π –ò—Å—Ç–æ—á–Ω–∏–∫ –ü—Ä–∞–≤–¥—ã** (Single Source of Truth)

#### 1. **Database-First –ü–æ–¥—Ö–æ–¥** ‚úÖ

**–í—Å–µ –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –¢–û–õ–¨–ö–û –≤ –ë–î:**
- ‚ùå –£–¥–∞–ª–∏—Ç—å ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `Integration` table
- ‚úÖ –®–∏—Ñ—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ `encryption.service.ts`

#### 2. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –•—Ä–∞–Ω–µ–Ω–∏—è**

**–î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (1 –∫–ª—é—á):**
```typescript
Integration {
  apiKey: 'encrypted:...',  // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω)
  config: {
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–ù–ï –∫–ª—é—á–∏)
    fromEmail: '...',
    baseUrl: '...'
  }
}
```

**–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–π):**
```typescript
Integration {
  apiKey: null,  // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  config: {
    // –í–°–ï –∫–ª—é—á–∏ –≤ config (–±—É–¥—É—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã —Ü–µ–ª–∏–∫–æ–º)
    appToken: 'sbx:...',
    secretKey: '...',
    levelName: '...'
  }
}
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å `config` JSON:
```typescript
// –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:
const encryptedConfig = encryptObject(config);
Integration.config = encryptedConfig;  // 'encrypted:...'

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:
const config = decryptObject(Integration.config);
```

#### 3. **–£–¥–∞–ª–µ–Ω–∏–µ Fallback –Ω–∞ ENV**

```typescript
// ‚ùå –£–¥–∞–ª–∏—Ç—å:
const apiKey = integration?.apiKey || config.email.apiKey;

// ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
if (!integration?.apiKey) {
  throw new Error('Integration not configured');
}
const apiKey = decrypt(integration.apiKey);
```

#### 4. **–£–ª—É—á—à–µ–Ω–∏–µ UI**

**–î–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π:**
- ‚úÖ –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —á–µ—Ç–∫–∏–µ –æ—à–∏–±–∫–∏ –µ—Å–ª–∏ –∫–ª—é—á –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

**–î–ª—è Sumsub (–º–Ω–æ–≥–æ–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤—ã–µ):**
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ `config`

---

## üîß –ü–ª–∞–Ω –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –û—á–∏—Å—Ç–∫–∞ (–°—Ä–æ—á–Ω–æ) ‚ö°

1. ‚úÖ **–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–≤–æ–π–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**
   - –°–∫—Ä–∏–ø—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω
   - –í—Å–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ —É–¥–∞–ª–µ–Ω—ã

2. ‚è≥ **–ü–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏**
   - Resend: `re_8AChNGre_7Ho83xrY2zF36xMT3214qtvF`
   - Sumsub: App Token + Secret Key
   - Tatum: (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
   - CoinGecko: (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)

3. ‚è≥ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ Resend
   - KYC —á–µ—Ä–µ–∑ Sumsub
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ —á–µ—Ä–µ–∑ CoinGecko

### –§–∞–∑–∞ 2: –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è (–í–∞–∂–Ω–æ) üìã

1. ‚è≥ **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞**
   - –ü—Ä–æ—Å—Ç—ã–µ (1 –∫–ª—é—á): `apiKey` field
   - –°–ª–æ–∂–Ω—ã–µ (–º–Ω–æ–≥–æ –∫–ª—é—á–µ–π): `config` JSON (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ü–µ–ª–∏–∫–æ–º)

2. ‚è≥ **–û–±–Ω–æ–≤–∏—Ç—å IntegrationFactory**
   - –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

3. ‚è≥ **–û–±–Ω–æ–≤–∏—Ç—å UI**
   - –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏
   - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ changed fields
   - –õ—É—á—à–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –§–∞–∑–∞ 3: –ú–∏–≥—Ä–∞—Ü–∏—è (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) üîÑ

1. ‚è≥ **–£–¥–∞–ª–∏—Ç—å ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**
   - –£–±—Ä–∞—Ç—å –∏–∑ `.env`, `.env.local`
   - –£–±—Ä–∞—Ç—å –∏–∑ `config.ts`
   - –£–±—Ä–∞—Ç—å fallback –ª–æ–≥–∏–∫—É

2. ‚è≥ **–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å config JSON**
   - –î–ª—è Sumsub –∏ –¥—Ä—É–≥–∏—Ö –º–Ω–æ–≥–æ–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤—ã—Ö
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `encryptObject()` / `decryptObject()`

3. ‚è≥ **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**
   - –ö–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á–∏
   - Troubleshooting guide

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:
1. –ü–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å Resend –∫–ª—é—á —á–µ—Ä–µ–∑ UI
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Sumsub —Ä–∞–±–æ—Ç–∞–µ—Ç
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email

### –°–µ–≥–æ–¥–Ω—è:
1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π
2. –£–±—Ä–∞—Ç—å fallback –Ω–∞ ENV
3. –£–ª—É—á—à–∏—Ç—å UI –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ:
1. –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Database-First
2. –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å config JSON
3. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## ‚úÖ –ß—Ç–æ –£–∂–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
2. ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏
3. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –º–Ω–æ–≥–æ–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üéì –í—ã–≤–æ–¥—ã

### –ì–ª–∞–≤–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã:
1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏** - –∫–ª—é—á–∏ –≤ ENV, DB.apiKey, DB.config
2. **–î–≤–æ–π–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** - –∏–∑-–∑–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —Å UI
3. **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** - —Ä–∞–∑–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É
4. **Fallback –ª–æ–≥–∏–∫–∞** - –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –æ—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è –∫–ª—é—á

### –†–µ—à–µ–Ω–∏–µ:
1. **Database-First** - –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã
2. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è** - –µ–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö
3. **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ config** - –¥–ª—è –º–Ω–æ–≥–æ–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
4. **–£–ª—É—á—à–µ–Ω–∏–µ UI** - –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –≤—Å–µ –∫–ª—é—á–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ - –ø–æ–Ω—è—Ç–Ω–æ –≥–¥–µ –∏ –∫–∞–∫ —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–ª—é—á–∏
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å - –Ω–µ—Ç –¥–≤–æ–π–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

