# Sumsub KYC Integration Status Report

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

### 1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å `IKycProvider` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
- ‚úÖ `SumsubAdapter` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ –º–µ—Ç–æ–¥—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- ‚úÖ `IntegrationFactory` –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ KYCAID, —Ç–∞–∫ –∏ Sumsub –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### 2. **Desktop WebSDK Flow**
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "Start Verification" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É
- ‚úÖ SDK token –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `/api/kyc/sdk-token`
- ‚úÖ `SumsubAdapter.createAccessToken()` —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω
- ‚úÖ WebSDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
- ‚úÖ Retry logic –¥–ª—è –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö applicants

### 3. **Mobile QR Flow**
- ‚úÖ QR-–∫–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `/api/kyc/mobile-link`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Sumsub `websdkLink` API
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—É—é –º–æ–±–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
- ‚úÖ Retry logic –¥–ª—è –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö applicants

### 4. **Deactivated Applicants Handling**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —Å –Ω–æ–≤—ã–º userId (userId-timestamp-random)
- ‚úÖ –î–æ 3 –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ endpoint
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–ª—è desktop, –∏ –¥–ª—è mobile

## üìä –°—Ç–∞—Ç—É—Å—ã Sumsub ‚Üí –ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞:

```typescript
Sumsub reviewStatus ‚Üí –ù–∞—à KycStatus
- init              ‚Üí PENDING
- pending           ‚Üí PENDING
- prechecked        ‚Üí PENDING
- queued            ‚Üí PENDING
- onHold            ‚Üí PENDING
- completed + GREEN ‚Üí APPROVED
- completed + RED   ‚Üí REJECTED
- completed + YELLOW ‚Üí PENDING (retry needed)
```

## üîç –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è (–∏–∑ –ª–æ–≥–æ–≤):

```
‚úÖ Sumsub status response: { reviewStatus: 'init', reviewAnswer: undefined }
üìä Mapped status: pending
‚ÑπÔ∏è KYC status unchanged: PENDING
```

**–≠—Ç–æ –ù–û–†–ú–ê–õ–¨–ù–û!** –°—Ç–∞—Ç—É—Å `init` –æ–∑–Ω–∞—á–∞–µ—Ç:
- Applicant —Å–æ–∑–¥–∞–Ω –≤ Sumsub
- WebSDK —Ç–æ–∫–µ–Ω –≤—ã–¥–∞–Ω
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –ù–ï –ø—Ä–æ—à–µ–ª –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ WebSDK
- –î–æ–∫—É–º–µ–Ω—Ç—ã –µ—â–µ –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω—ã

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Sumsub KYC Flow:

### **–í–∞—Ä–∏–∞–Ω—Ç 1: Desktop WebSDK**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "Start Verification"
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–∞ —Å Sumsub WebSDK
3. **WebSDK —Å–∞–º —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ**:
   - –§–æ—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–ø–∞—Å–ø–æ—Ä—Ç/ID)
   - –°–µ–ª—Ñ–∏ —Å liveness detection
   - –ê–¥—Ä–µ—Å –∏ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è levelName)
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç ‚Üí WebSDK –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Sumsub
5. Sumsub –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ‚Üí —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `pending` ‚Üí `completed`
6. Webhook –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫ –Ω–∞–º ‚Üí –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –ë–î

### **–í–∞—Ä–∏–∞–Ω—Ç 2: Mobile QR**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR-–∫–æ–¥
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Sumsub Mobile SDK –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
3. –ü—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω Desktop WebSDK
4. –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ Sumsub
5. Webhook –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —É –Ω–∞—Å

## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –î–∞–Ω–Ω—ã–µ –∏–∑ –Ω–∞—à–µ–π KYC —Ñ–æ—Ä–º—ã

### **–î–ª—è KYCAID:**
- ‚úÖ –ù–∞—à–∞ —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API
- ‚úÖ `submitKycForm()` –≤ `kyc.service.ts`
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã ‚Üí KYCAID API

### **–î–ª—è Sumsub:**
- ‚ùå **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à—É KYC —Ñ–æ—Ä–º—É!**
- ‚úÖ WebSDK —Å–∞–º —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –≤–Ω—É—Ç—Ä–∏ WebSDK
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∏–¥—É—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ Sumsub (–Ω–µ —á–µ—Ä–µ–∑ –Ω–∞—à backend)

## üîß –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

### 1. **WebSDK Events**
–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ WebSDK –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è:
```typescript
// –í src/app/(client)/kyc/page.tsx
.on('idCheck.onApplicantSubmitted', () => {
  toast.success('Verification submitted!');
  fetchKycStatus(true); // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
})
```

### 2. **Webhook Endpoint**
–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Sumsub Dashboard:
- URL: `https://your-domain.com/api/kyc/webhook/sumsub`
- Signature verification —Ä–∞–±–æ—Ç–∞–µ—Ç
- –û–±–Ω–æ–≤–ª—è–µ—Ç `KycSession` –≤ –ë–î

### 3. **Status Polling**
–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ `/api/kyc/status` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Sumsub:
```typescript
// –î–æ–ª–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å SumsubAdapter.getVerificationStatus()
// –ò –º–∞–ø–ø–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### ‚úÖ **–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å:**
1. –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. Retry logic –¥–ª—è deactivated applicants - —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É
3. –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
4. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ KYCAID (—Ñ–æ—Ä–º–∞) –∏ Sumsub (WebSDK) - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ

### üîß **–ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:**
1. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ WebSDK events**
   - –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
   - –ö–æ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã
   - –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ

2. **–£–ª—É—á—à–∏—Ç—å UX –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ "init"**
   - –ü–æ–∫–∞–∑–∞—Ç—å "Waiting for verification to start"
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: "Click 'Start Verification' or scan QR code"

3. **Webhook —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ webhook –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç Sumsub
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ webhook —Å–æ–±—ã—Ç–∏—è
   - –û–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üéØ –ò—Ç–æ–≥:

**–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** –°—Ç–∞—Ç—É—Å `init` / `PENDING` - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–æ—à–µ–ª –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ WebSDK.

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. –ù–∞–∂–∞—Ç—å "Start Verification" (desktop) –∏–ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR (mobile)
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –≤ WebSDK
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
4. –ü—Ä–æ–π—Ç–∏ liveness check
5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å ‚Üí Sumsub –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí webhook –æ–±–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ç—É—Å

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö** - –æ–Ω–∞ –º–æ–¥—É–ª—å–Ω–∞—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

