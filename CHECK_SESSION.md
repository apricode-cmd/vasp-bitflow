# üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –†–ê–ó–õ–û–ì–ò–ù–ò–í–ê–ù–ò–Ø

## –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ Cookie –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `http://localhost:3000/admin/auth/login`
2. –í–æ–π–¥–∏—Ç–µ —Å Passkey
3. **–°–†–ê–ó–£ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞** –æ—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
4. Application ‚Üí Cookies ‚Üí `http://localhost:3000`
5. –ù–∞–π–¥–∏—Ç–µ: `next-auth.session-token.admin`

### ‚ùì –í–æ–ø—Ä–æ—Å—ã:
- [ ] Cookie —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
- [ ] Expires = —á–µ—Ä–µ–∑ ~30 –¥–Ω–µ–π?
- [ ] Path = `/`?
- [ ] HttpOnly = ‚úì?
- [ ] SameSite = `Lax`?

---

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ NextAuth Session

–í Console –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
fetch('/api/auth/session')
  .then(r => r.json())
  .then(data => console.log('Session:', data));
```

### ‚ùì –†–µ–∑—É–ª—å—Ç–∞—Ç:
- [ ] `{ user: { email, role, ... } }` ‚Üê **–•–æ—Ä–æ—à–æ**
- [ ] `{}` –∏–ª–∏ `null` ‚Üê **–ü–ª–æ—Ö–æ, —Å–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞**

---

## –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ Admin API

–í Console –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
fetch('/api/admin/profile')
  .then(r => r.json())
  .then(data => console.log('Profile:', data));
```

### ‚ùì –†–µ–∑—É–ª—å—Ç–∞—Ç:
- [ ] `{ success: true, profile: {...} }` ‚Üê **–•–æ—Ä–æ—à–æ**
- [ ] `{ success: false, error: "Unauthorized" }` ‚Üê **–ü–ª–æ—Ö–æ**

---

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ Network –ø—Ä–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí **Network** tab
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/admin`
3. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å `/api/admin/stats?range=week`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

### Request Headers:
```
Cookie: next-auth.session-token.admin=...
```
‚ùì Cookie –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è? [ ] –î–∞ [ ] –ù–µ—Ç

### Response:
```
Status: 401 Unauthorized
{ "success": false, "error": "Unauthorized" }
```
‚ùì –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401? [ ] –î–∞ [ ] –ù–µ—Ç

---

## –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ Server Logs

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä –Ω–∞–π–¥–∏—Ç–µ:

```
‚úÖ Middleware: Admin session valid for admin@apricode.io
```
–∏–ª–∏
```
‚ùå Middleware: No admin session, redirecting to /admin/auth/login
```

### ‚ùì –ß—Ç–æ –≤ –ª–æ–≥–∞—Ö?
- [ ] "Admin session valid" ‚Üê **–•–æ—Ä–æ—à–æ**
- [ ] "No admin session" ‚Üê **Middleware –Ω–µ –≤–∏–¥–∏—Ç —Å–µ—Å—Å–∏—é**
- [ ] –ù–∏—á–µ–≥–æ ‚Üê **Middleware –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç**

---

## üéØ –î–ò–ê–ì–ù–û–ó:

### –ï—Å–ª–∏ Cookie –ï–°–¢–¨, –Ω–æ Session = {}:
**–ü—Ä–æ–±–ª–µ–º–∞:** JWT –Ω–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** 
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `NEXTAUTH_ADMIN_SECRET` –≤ `.env.local`
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ–Ω –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `NEXTAUTH_SECRET`

### –ï—Å–ª–∏ Cookie –ù–ï–¢:
**–ü—Ä–æ–±–ª–µ–º–∞:** Cookie –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `path: '/'` –≤ `auth-admin.ts`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `sameSite: 'lax'`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–æ–º–µ–Ω –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π (–Ω–µ localhost:3001 ‚Üí localhost:3000)

### –ï—Å–ª–∏ 401 —Ç–æ–ª—å–∫–æ –Ω–∞ `/api/admin/*`:
**–ü—Ä–æ–±–ª–µ–º–∞:** `getAdminSession()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ API routes
**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –∏–∑ `auth-admin.ts`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ API route –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `getAdminSession()`, –Ω–µ `auth()`

### –ï—Å–ª–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ—Ç —á–µ—Ä–µ–∑ N –º–∏–Ω—É—Ç:
**–ü—Ä–æ–±–ª–µ–º–∞:** JWT expires —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ
**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å `maxAge` –≤ `auth-admin.ts`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `updateAge`

---

## üìù –û—Ç—á–µ—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:

```
1. Cookie next-auth.session-token.admin:
   [X] –ï—Å—Ç—å [ ] –ù–µ—Ç
   Expires: [–¥–∞—Ç–∞]

2. /api/auth/session —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   [–∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ –∏ –¥–∞–Ω–Ω—ã–µ]

3. /api/admin/profile —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   [–∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ –∏ –¥–∞–Ω–Ω—ã–µ]

4. Server logs:
   [—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ middleware]

5. –ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ—Ç:
   [—á–∏—Å–ª–æ]
```

