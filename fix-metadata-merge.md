# –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ metadata merge

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. **–°–æ–∑–¥–∞–Ω–∞ helper —Ñ—É–Ω–∫—Ü–∏—è `mergeMetadata()`** - –±–µ–∑–æ–ø–∞—Å–Ω–æ –º–µ—Ä–∂–∏—Ç metadata, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
2. **–û–±–Ω–æ–≤–ª–µ–Ω `startKycVerification()`** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `mergeMetadata()` –≤ `update` –±–ª–æ–∫–µ

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞–ª—å—à–µ:

–í—Å–µ –º–µ—Å—Ç–∞ –≥–¥–µ `prisma.kycSession.update()` –æ–±–Ω–æ–≤–ª—è–µ—Ç `metadata`, –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `mergeMetadata()`:

### –ú–µ—Å—Ç–∞ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (11 —à—Ç):

1. **–°—Ç—Ä–æ–∫–∞ 477-489** - `checkKycStatus()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
2. **–°—Ç—Ä–æ–∫–∞ 497-505** - `checkKycStatus()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ lastChecked
3. **–°—Ç—Ä–æ–∫–∞ 514-523** - `checkKycStatus()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ 404 –æ—à–∏–±–∫–∏
4. **–°—Ç—Ä–æ–∫–∞ 548-557** - `checkKycStatus()` - —Å–æ–∑–¥–∞–Ω–∏–µ verification
5. **–°—Ç—Ä–æ–∫–∞ 566-577** - `checkKycStatus()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è verification
6. **–°—Ç—Ä–æ–∫–∞ 606-616** - `checkKycStatus()` - APPROVED —Å—Ç–∞—Ç—É—Å
7. **–°—Ç—Ä–æ–∫–∞ 623-633** - `checkKycStatus()` - REJECTED —Å—Ç–∞—Ç—É—Å
8. **–°—Ç—Ä–æ–∫–∞ 655-664** - `checkKycStatus()` - 404 –≤ catch –±–ª–æ–∫–µ
9. **–°—Ç—Ä–æ–∫–∞ 743-757** - `processKycWebhook()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ webhook
10. **–°—Ç—Ä–æ–∫–∞ 877-886** - `syncDocumentsToKycaid()` - sync attempt
11. **–°—Ç—Ä–æ–∫–∞ 981-990** - `syncDocumentsToKycaid()` - documents synced

### –ü–∞—Ç—Ç–µ—Ä–Ω –∑–∞–º–µ–Ω—ã:

**–ë—ã–ª–æ:**
```typescript
metadata: {
  ...session.metadata as any,
  newField: value
}
```

**–°—Ç–∞–ª–æ:**
```typescript
metadata: mergeMetadata(session.metadata, {
  newField: value
})
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úÖ **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç `applicant.externalUserId`** - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Sumsub —Å retry
‚úÖ **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è** - –Ω–µ —Ç–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ
‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤** - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
‚úÖ **–ù–µ –ª–æ–º–∞–µ—Ç KYCAID** - —Ä–∞–±–æ—á–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º
‚úÖ **–ì–æ—Ç–æ–≤–æ –¥–ª—è –±—É–¥—É—â–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤** - –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:

–§—É–Ω–∫—Ü–∏—è `mergeMetadata()` –¥–µ–ª–∞–µ—Ç **deep merge** –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ `applicant`, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è `externalUserId` –∏ –¥—Ä—É–≥–∏—Ö –¥–∞–Ω–Ω—ã—Ö applicant.

