# Admin Actions Logic

## Overview
–õ–æ–≥–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π (Actions) –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Ö —Å—Ç–∞—Ç—É—Å–∞ –∏ —Ä–æ–ª–∏.

## Actions –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º

### 1. INVITED (–ü—Ä–∏–≥–ª–∞—à—ë–Ω)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ê–¥–º–∏–Ω –ø—Ä–∏–≥–ª–∞—à—ë–Ω, –Ω–æ –µ—â—ë –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é Passkey.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- üìß **Resend Invite** - –ü–æ–≤—Ç–æ—Ä–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ (–µ—Å–ª–∏ –∏—Å—Ç—ë–∫ —Å—Ä–æ–∫)
- üóëÔ∏è **Cancel Invitation** - –û—Ç–º–µ–Ω–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ (—É–¥–∞–ª–∏—Ç—å)

**–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 15 –º–∏–Ω—É—Ç —Å –º–æ–º–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å
- –ù–µ–ª—å–∑—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å

---

### 2. ACTIVE (–ê–∫—Ç–∏–≤–Ω—ã–π)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ê–¥–º–∏–Ω –∞–∫—Ç–∏–≤–µ–Ω –∏ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ.

#### 2.1 –î–ª—è —Å–µ–±—è (You)
**–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- ‚úèÔ∏è **Edit Profile** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
- üõ°Ô∏è **Security Settings** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Passkeys, MFA)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ–ª—å–∑—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ–±—è
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–µ–±—è
- –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ—é —Ä–æ–ª—å

#### 2.2 –î–ª—è –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤
**–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- ‚úèÔ∏è **Edit Details** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (–∏–º—è, email, –¥–æ–ª–∂–Ω–æ—Å—Ç—å)
- üë§ **Change Role** - –ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å (ADMIN ‚Üí COMPLIANCE, etc.)
- ‚è∏Ô∏è **Suspend** - –í—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø
- üóëÔ∏è **Terminate** - –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ —É–≤–æ–ª–∏—Ç—å (TERMINATED)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- **Edit/Change Role:** –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ `admins:update`
- **Suspend:** –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ `admins:suspend`
- **Terminate:** –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ `admins:delete` + Step-up MFA

---

### 3. SUSPENDED (–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ê–¥–º–∏–Ω –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–æ—Ç–ø—É—Å–∫, —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, etc.)

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- ‚úÖ **Reactivate** - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø (—Å—Ç–∞—Ç—É—Å ‚Üí ACTIVE)
- üóëÔ∏è **Terminate Permanently** - –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ —É–≤–æ–ª–∏—Ç—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- **Reactivate:** –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ `admins:update`
- **Terminate:** –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ `admins:delete` + Step-up MFA

---

### 4. TERMINATED (–£–≤–æ–ª–µ–Ω)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ê–¥–º–∏–Ω –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ —É–≤–æ–ª–µ–Ω. –í—Å–µ –¥–æ—Å—Ç—É–ø—ã –æ—Ç–æ–∑–≤–∞–Ω—ã.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- ‚ÑπÔ∏è **No actions available** - –ù–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ–ª—å–∑—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞)
- –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ (Audit Log)

---

## Permissions Matrix

| Action | Permission Required | Step-up MFA | Notes |
|--------|-------------------|-------------|-------|
| Resend Invite | `admins:create` | ‚ùå | –¢–æ–ª—å–∫–æ –¥–ª—è INVITED |
| Cancel Invitation | `admins:delete` | ‚ùå | –¢–æ–ª—å–∫–æ –¥–ª—è INVITED |
| Edit Profile (Self) | - | ‚ùå | –í—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–æ |
| Security Settings (Self) | - | ‚ùå | –í—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–æ |
| Edit Details | `admins:update` | ‚ùå | –ù–µ –¥–ª—è —Å–µ–±—è |
| Change Role | `admins:update` | ‚úÖ | –ù–µ –¥–ª—è —Å–µ–±—è, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ |
| Suspend | `admins:suspend` | ‚úÖ | –ù–µ –¥–ª—è —Å–µ–±—è |
| Reactivate | `admins:update` | ‚ùå | –¢–æ–ª—å–∫–æ –¥–ª—è SUSPENDED |
| Terminate | `admins:delete` | ‚úÖ | –ù–µ –¥–ª—è —Å–µ–±—è, –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ |

---

## Security Features

### Step-up MFA
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Ç—Ä–µ–±—É—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Passkey:
- Invite New Admin
- Change Admin Role
- Suspend Admin
- Terminate Admin

### Audit Logging
–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `AdminAuditLog`:
- –ö—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª –¥–µ–π—Å—Ç–≤–∏–µ
- –ö–æ–≥–¥–∞ (timestamp)
- –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (diff)
- IP –∞–¥—Ä–µ—Å –∏ User Agent
- MFA verification details

### Token Expiration
- **Invite Token:** 15 –º–∏–Ω—É—Ç (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- **Session Token:** 24 —á–∞—Å–∞ (—É–¥–æ–±—Å—Ç–≤–æ)
- **MFA Challenge:** 5 –º–∏–Ω—É—Ç

---

## UI/UX Guidelines

### Colors
- **INVITED:** Blue (`text-blue-600`)
- **ACTIVE:** Green (`text-green-600`)
- **SUSPENDED:** Amber (`text-amber-600`)
- **TERMINATED:** Red (`text-destructive`)

### Icons
- Resend Invite: `Mail`
- Edit: `Edit`
- Change Role: `UserCog`
- Suspend: `Ban`
- Reactivate: `CheckCircle`
- Terminate: `Trash2`
- Security: `Shield`
- Info: `Info`

### Confirmation Dialogs
- **Suspend:** "Are you sure? They will be unable to access..."
- **Terminate:** "This action is permanent and cannot be undone..."
- **Cancel Invitation:** "This will delete the invitation..."

---

## Implementation Status

‚úÖ **Completed:**
- INVITED status support
- 15-minute token expiration
- Step-up MFA for critical actions
- Actions menu logic
- Status badges
- Metrics dashboard

üîÑ **In Progress:**
- Resend Invite functionality
- Edit Profile/Details dialogs
- Change Role dialog
- Security Settings page

üìã **Planned:**
- Bulk actions (suspend multiple admins)
- Admin activity timeline
- Role templates
- Automated suspension (inactivity)

---

## Testing Checklist

- [ ] Invite admin ‚Üí receive link ‚Üí register Passkey ‚Üí status ACTIVE
- [ ] Resend invite for expired token
- [ ] Cancel invitation (INVITED ‚Üí deleted)
- [ ] Edit own profile (self)
- [ ] Edit other admin details
- [ ] Change admin role (with MFA)
- [ ] Suspend admin (with MFA)
- [ ] Reactivate suspended admin
- [ ] Terminate admin (with MFA)
- [ ] Verify audit logs for all actions
- [ ] Test permissions (ADMIN vs COMPLIANCE vs READ_ONLY)
- [ ] Test "You" badge (cannot suspend/terminate self)

---

## API Endpoints

```
POST /api/admin/admins/invite          - Invite new admin (Step-up MFA)
POST /api/admin/admins/[id]/suspend    - Suspend admin (Step-up MFA)
POST /api/admin/admins/[id]/reactivate - Reactivate admin
POST /api/admin/admins/[id]/terminate  - Terminate admin (Step-up MFA)
POST /api/admin/admins/[id]/role       - Change role (Step-up MFA)
PATCH /api/admin/admins/[id]           - Update admin details
```

---

**Last Updated:** 2025-11-10
**Version:** 1.0.0

