#!/bin/bash

# =============================================================================
# 🔓 РУЧНАЯ РАСШИФРОВКА BCB CREDENTIALS
# =============================================================================
# Этот скрипт нужно запустить в ВАШЕМ терминале напрямую

clear
echo "╔═══════════════════════════════════════════════════════════════════════════════╗"
echo "║                   🔓 РАСШИФРОВКА BCB CREDENTIALS                             ║"
echo "╚═══════════════════════════════════════════════════════════════════════════════╝"
echo ""
echo "📋 Мы попробуем расшифровать файл: Sandbox_credentials.api (4).gpg"
echo ""
echo "🔑 Ваш GPG ключ:"
echo "   ID: 6BF35EB4F94F2ABB"
echo "   Email: admin@bitflow.biz"
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

# Перейдем в директорию
cd "/Users/bogdankononenko/Работа/Development/Project/crm vasp/credentials/bcb-sandbox" || exit 1

# Проверим что файл существует
if [ ! -f "Sandbox_credentials.api (4).gpg" ]; then
    echo "❌ Файл не найден!"
    exit 1
fi

echo "✅ Файл найден"
echo ""
echo "🔐 Сейчас откроется окно для ввода пароля GPG"
echo "   (Если вы не ставили пароль при создании, попробуйте оставить пустым)"
echo ""
echo "⏳ Запускаю расшифровку..."
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

# Попробуем интерактивно
gpg --decrypt "Sandbox_credentials.api (4).gpg"

# Если успешно
if [ $? -eq 0 ]; then
    echo ""
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo "🎉 УСПЕХ! Credentials расшифрованы!"
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo ""
    
    # Сохраним в файл
    echo "💾 Сохраняю credentials в файл..."
    gpg --decrypt "Sandbox_credentials.api (4).gpg" > credentials.txt 2>/dev/null
    
    if [ -f "credentials.txt" ]; then
        echo "✅ Credentials сохранены в: credentials.txt"
        echo ""
        echo "📋 Содержимое:"
        cat credentials.txt
    fi
else
    echo ""
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo "❌ Не удалось расшифровать"
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo ""
    echo "💡 Возможные причины:"
    echo ""
    echo "1️⃣  Неправильный пароль"
    echo "   👉 Попробуйте вспомнить пароль который вводили 24 ноября"
    echo "   👉 Возможно вы использовали стандартный пароль для проекта?"
    echo ""
    echo "2️⃣  Пароль в macOS Keychain"
    echo "   👉 Откройте 'Keychain Access' (Связка ключей)"
    echo "   👉 Поиск: 'gpg' или 'admin@bitflow.biz'"
    echo ""
    echo "3️⃣  Пароль не задавался, но GPG требует"
    echo "   👉 Возможно был автоматический пароль"
    echo ""
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo ""
    echo "🔄 ЧТО ДЕЛАТЬ ДАЛЬШЕ:"
    echo ""
    echo "Вариант A: Попробовать еще раз (может вспомните пароль)"
    echo "   bash DECRYPT_MANUAL.sh"
    echo ""
    echo "Вариант B: Создать новый GPG ключ БЕЗ пароля"
    echo "   bash CREATE_NEW_KEY.sh"
    echo ""
    echo "Вариант C: Написать BCB Support"
    echo "   cat EMAIL_TO_BCB_SUPPORT.txt"
    echo ""
fi

echo ""


